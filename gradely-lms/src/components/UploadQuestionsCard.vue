<template>
  <div>
    <div class="create-upload-card-wrapper">
      <div class="document-template">
        <div class="title-main-wrapper">Document Templates</div>
        <section class="sub-title-main-wrapper">
          Use any of the following document templates to create compatible
          questions upload.
        </section>
        <div class="wrapper-main-template-format-upload">
          <div class="excel-format-template-wrapper">
            <span class="excel-icon-wrapper">
              <svg
                width="24"
                height="25"
                viewBox="0 0 24 25"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clip-path="url(#clip0)">
                  <path
                    d="M23.25 21.1897H12.75C12.336 21.1897 12 20.8542 12 20.4409C12 20.0275 12 5.87798 12 5.46463C12 5.05129 12.336 4.71582 12.75 4.71582H23.25C23.664 4.71582 24 5.05129 24 5.46463V20.4409C24 20.8542 23.664 21.1897 23.25 21.1897Z"
                    fill="#F5F5F5"
                  />
                  <path
                    d="M15.75 9.20905H12.75C12.336 9.20905 12 8.87358 12 8.46024C12 8.04689 12.336 7.71143 12.75 7.71143H15.75C16.164 7.71143 16.5 8.04689 16.5 8.46024C16.5 8.87358 16.164 9.20905 15.75 9.20905Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M15.75 12.2042H12.75C12.336 12.2042 12 11.8687 12 11.4554C12 11.042 12.336 10.7065 12.75 10.7065H15.75C16.164 10.7065 16.5 11.042 16.5 11.4554C16.5 11.8687 16.164 12.2042 15.75 12.2042Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M15.75 15.1998H12.75C12.336 15.1998 12 14.8643 12 14.451C12 14.0376 12.336 13.7021 12.75 13.7021H15.75C16.164 13.7021 16.5 14.0376 16.5 14.451C16.5 14.8643 16.164 15.1998 15.75 15.1998Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M15.75 18.1954H12.75C12.336 18.1954 12 17.8599 12 17.4466C12 17.0332 12.336 16.6978 12.75 16.6978H15.75C16.164 16.6978 16.5 17.0332 16.5 17.4466C16.5 17.8599 16.164 18.1954 15.75 18.1954Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M20.25 9.20905H18.75C18.336 9.20905 18 8.87358 18 8.46024C18 8.04689 18.336 7.71143 18.75 7.71143H20.25C20.664 7.71143 21 8.04689 21 8.46024C21 8.87358 20.664 9.20905 20.25 9.20905Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M20.25 12.2042H18.75C18.336 12.2042 18 11.8687 18 11.4554C18 11.042 18.336 10.7065 18.75 10.7065H20.25C20.664 10.7065 21 11.042 21 11.4554C21 11.8687 20.664 12.2042 20.25 12.2042Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M20.25 15.1998H18.75C18.336 15.1998 18 14.8643 18 14.451C18 14.0376 18.336 13.7021 18.75 13.7021H20.25C20.664 13.7021 21 14.0376 21 14.451C21 14.8643 20.664 15.1998 20.25 15.1998Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M20.25 18.1954H18.75C18.336 18.1954 18 17.8599 18 17.4466C18 17.0332 18.336 16.6978 18.75 16.6978H20.25C20.664 16.6978 21 17.0332 21 17.4466C21 17.8599 20.664 18.1954 20.25 18.1954Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M13.2285 1.89345C13.0575 1.75118 12.828 1.68977 12.612 1.7347L0.612 3.98114C0.2565 4.04703 0 4.35554 0 4.71647V21.1903C0 21.5497 0.2565 21.8598 0.612 21.9257L12.612 24.1721C12.657 24.1811 12.7035 24.1856 12.75 24.1856C12.924 24.1856 13.0935 24.1257 13.2285 24.0133C13.401 23.8711 13.5 23.6584 13.5 23.4368V2.47004C13.5 2.24689 13.401 2.03572 13.2285 1.89345Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M10.3138 15.4561L7.9423 12.7499L10.3408 9.67078C10.5958 9.3443 10.5358 8.87404 10.2103 8.61945C9.88479 8.36485 9.41379 8.42476 9.15729 8.74974L6.93579 11.6012L5.06379 9.4656C4.78929 9.1511 4.31529 9.12265 4.00629 9.39522C3.69429 9.66778 3.66279 10.141 3.93579 10.451L5.99829 12.8053L3.90729 15.489C3.65229 15.8155 3.71229 16.2858 4.03779 16.5404C4.17579 16.6467 4.33929 16.6976 4.49979 16.6976C4.72329 16.6976 4.94379 16.5988 5.09229 16.4086L7.0048 13.9525L9.18579 16.44C9.33429 16.6108 9.54129 16.6976 9.74979 16.6976C9.92529 16.6976 10.1008 16.6362 10.2433 16.5119C10.5553 16.2394 10.5868 15.7661 10.3138 15.4561Z"
                    fill="#F5F5F5"
                  />
                </g>
                <defs>
                  <clipPath id="clip0">
                    <rect
                      width="24"
                      height="23.962"
                      fill="white"
                      transform="translate(0 0.97168)"
                    />
                  </clipPath>
                </defs>
              </svg>
            </span>
            <span class="template-details-card-wrapper">
              <section :title="`Question_template.txt`" class="question-xls">
                {{ getTruncatedText(`Question_template.xls`, 10) }}
              </section>
              <section class="meta-sub-title-question-xls">
                Download Excel File
              </section>
            </span>
            <span class="template-download-icon">
              <a
                download="gradely-excel-sample"
                href="https://gradly.s3.eu-west-2.amazonaws.com/files/samples/gradely-excel-sample.xlsx"
                target="_blank"
                class="icon-download avatar"
              ></a>
            </span>
          </div>

          <div class="ms-word-format-template-wrapper">
            <span class="ms-word-icon-wrapper">
              <svg
                width="24"
                height="25"
                viewBox="0 0 24 25"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clip-path="url(#clip0)">
                  <path
                    d="M14.6392 22.8648C14.6709 22.8665 14.7023 22.8692 14.7346 22.8692H22.0007C22.8506 22.8692 23.542 22.1788 23.542 21.3304V4.51319C23.542 3.66487 22.8506 2.97434 22.0007 2.97434H14.7346C14.7026 2.97434 14.6709 2.97749 14.6392 2.97896V0.97168L0.45752 2.86134V22.9951L14.6392 24.9336V22.8648ZM14.7346 3.8539H22.0007C22.365 3.8539 22.6612 4.14982 22.6612 4.51339V21.3308C22.6612 21.6943 22.365 21.9904 22.0007 21.9904H14.7346C14.7022 21.9904 14.6706 21.9852 14.6392 21.9804V16.6097H21.4029C21.5651 16.6097 21.6966 16.4786 21.6966 16.317C21.6966 16.1553 21.5651 16.0239 21.4029 16.0239H14.6392V14.2274H21.4029C21.565 14.2274 21.6966 14.0961 21.6966 13.9344C21.6966 13.7727 21.565 13.6416 21.4029 13.6416H14.6392V11.9009H21.4029C21.565 11.9009 21.6966 11.7696 21.6966 11.6081C21.6966 11.4463 21.565 11.3152 21.4029 11.3152H14.6392V9.55781H18.2778C18.4396 9.55781 18.5715 9.42665 18.5715 9.26499C18.5715 9.10324 18.4396 8.97229 18.2778 8.97229H14.6392V3.86351C14.6705 3.85893 14.702 3.8539 14.7346 3.8539ZM4.592 11.5021L3.41022 11.521V15.2133L2.45004 15.1888V11.5373L1.34138 11.556V10.7098L4.5922 10.6248V11.5021H4.592V11.5021ZM7.64747 15.3191L7.22475 14.4484C7.05316 14.1148 6.94306 13.8668 6.81321 13.592L6.79932 13.5911C6.70331 13.8651 6.58817 14.1087 6.4455 14.4359L6.06738 15.2792L4.91281 15.2508L6.20895 12.9046L4.95786 10.6151L6.12194 10.585L6.51947 11.4348C6.65665 11.72 6.75811 11.9499 6.86781 12.2155L6.8812 12.2157C6.99172 11.9118 7.08064 11.6998 7.19783 11.4234L7.59176 10.5465L8.81728 10.5137L7.48112 12.8754L8.88876 15.3503L7.64747 15.3191ZM13.0295 11.3621L11.6173 11.3855V15.4185L10.4735 15.3893V11.4048L9.15456 11.4267V10.5049L13.0299 10.4032V11.362H13.0295V11.3621Z"
                    fill="#113255"
                  />
                </g>
                <defs>
                  <clipPath id="clip0">
                    <rect
                      width="24"
                      height="23.962"
                      fill="white"
                      transform="translate(0 0.97168)"
                    />
                  </clipPath>
                </defs>
              </svg>
            </span>
            <span class="template-details-card-wrapper">
              <section :title="`Question_template.txt`" class="question-xls">
                {{ getTruncatedText(`Question_template.txt`, 10) }}
              </section>
              <section class="meta-sub-title-question-xls">
                Download Txt File
              </section>
            </span>
            <span class="template-download-icon">
              <a
                download="gradely-text-sample"
                href="https://gradly.s3.eu-west-2.amazonaws.com/files/samples/gradely-aiken-format.txt"
                target="_blank"
                class="icon-download avatar"
              ></a>
            </span>
          </div>
        </div>
        <div class="learn-more-label-wrapper">
          <span class="learn-more">Learn more about</span>
          <a
            href="https://bit.ly/Gradely-Aiken"
            target="_blank"
            rel="noopener"
            class="accent-bulk-main-label"
          >
            bulk question upload here
          </a>
        </div>

        <upload-file
          ref="upload-child"
          meta_header="Upload File"
          :show_meta="false"
          @change="handleFileUpload"
        ></upload-file>
        <!--  -->
        <section v-if="new_file" class="wrapper-main-template-format-upload">
          <div class="ms-word-format-template-wrapper">
            <span
              v-if="new_file.name.split('.').pop() === 'txt'"
              class="ms-word-icon-wrapper"
            >
              <svg
                width="24"
                height="25"
                viewBox="0 0 24 25"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clip-path="url(#clip0)">
                  <path
                    d="M14.6392 22.8648C14.6709 22.8665 14.7023 22.8692 14.7346 22.8692H22.0007C22.8506 22.8692 23.542 22.1788 23.542 21.3304V4.51319C23.542 3.66487 22.8506 2.97434 22.0007 2.97434H14.7346C14.7026 2.97434 14.6709 2.97749 14.6392 2.97896V0.97168L0.45752 2.86134V22.9951L14.6392 24.9336V22.8648ZM14.7346 3.8539H22.0007C22.365 3.8539 22.6612 4.14982 22.6612 4.51339V21.3308C22.6612 21.6943 22.365 21.9904 22.0007 21.9904H14.7346C14.7022 21.9904 14.6706 21.9852 14.6392 21.9804V16.6097H21.4029C21.5651 16.6097 21.6966 16.4786 21.6966 16.317C21.6966 16.1553 21.5651 16.0239 21.4029 16.0239H14.6392V14.2274H21.4029C21.565 14.2274 21.6966 14.0961 21.6966 13.9344C21.6966 13.7727 21.565 13.6416 21.4029 13.6416H14.6392V11.9009H21.4029C21.565 11.9009 21.6966 11.7696 21.6966 11.6081C21.6966 11.4463 21.565 11.3152 21.4029 11.3152H14.6392V9.55781H18.2778C18.4396 9.55781 18.5715 9.42665 18.5715 9.26499C18.5715 9.10324 18.4396 8.97229 18.2778 8.97229H14.6392V3.86351C14.6705 3.85893 14.702 3.8539 14.7346 3.8539ZM4.592 11.5021L3.41022 11.521V15.2133L2.45004 15.1888V11.5373L1.34138 11.556V10.7098L4.5922 10.6248V11.5021H4.592V11.5021ZM7.64747 15.3191L7.22475 14.4484C7.05316 14.1148 6.94306 13.8668 6.81321 13.592L6.79932 13.5911C6.70331 13.8651 6.58817 14.1087 6.4455 14.4359L6.06738 15.2792L4.91281 15.2508L6.20895 12.9046L4.95786 10.6151L6.12194 10.585L6.51947 11.4348C6.65665 11.72 6.75811 11.9499 6.86781 12.2155L6.8812 12.2157C6.99172 11.9118 7.08064 11.6998 7.19783 11.4234L7.59176 10.5465L8.81728 10.5137L7.48112 12.8754L8.88876 15.3503L7.64747 15.3191ZM13.0295 11.3621L11.6173 11.3855V15.4185L10.4735 15.3893V11.4048L9.15456 11.4267V10.5049L13.0299 10.4032V11.362H13.0295V11.3621Z"
                    fill="#113255"
                  />
                </g>
                <defs>
                  <clipPath id="clip0">
                    <rect
                      width="24"
                      height="23.962"
                      fill="white"
                      transform="translate(0 0.97168)"
                    />
                  </clipPath>
                </defs>
              </svg>
            </span>
            <span
              v-if="
                new_file.name.split('.').pop() === 'xls' ||
                  new_file.name.split('.').pop() === 'xlsx'
              "
              class="excel-icon-wrapper"
            >
              <svg
                width="24"
                height="25"
                viewBox="0 0 24 25"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clip-path="url(#clip0)">
                  <path
                    d="M23.25 21.1897H12.75C12.336 21.1897 12 20.8542 12 20.4409C12 20.0275 12 5.87798 12 5.46463C12 5.05129 12.336 4.71582 12.75 4.71582H23.25C23.664 4.71582 24 5.05129 24 5.46463V20.4409C24 20.8542 23.664 21.1897 23.25 21.1897Z"
                    fill="#F5F5F5"
                  />
                  <path
                    d="M15.75 9.20905H12.75C12.336 9.20905 12 8.87358 12 8.46024C12 8.04689 12.336 7.71143 12.75 7.71143H15.75C16.164 7.71143 16.5 8.04689 16.5 8.46024C16.5 8.87358 16.164 9.20905 15.75 9.20905Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M15.75 12.2042H12.75C12.336 12.2042 12 11.8687 12 11.4554C12 11.042 12.336 10.7065 12.75 10.7065H15.75C16.164 10.7065 16.5 11.042 16.5 11.4554C16.5 11.8687 16.164 12.2042 15.75 12.2042Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M15.75 15.1998H12.75C12.336 15.1998 12 14.8643 12 14.451C12 14.0376 12.336 13.7021 12.75 13.7021H15.75C16.164 13.7021 16.5 14.0376 16.5 14.451C16.5 14.8643 16.164 15.1998 15.75 15.1998Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M15.75 18.1954H12.75C12.336 18.1954 12 17.8599 12 17.4466C12 17.0332 12.336 16.6978 12.75 16.6978H15.75C16.164 16.6978 16.5 17.0332 16.5 17.4466C16.5 17.8599 16.164 18.1954 15.75 18.1954Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M20.25 9.20905H18.75C18.336 9.20905 18 8.87358 18 8.46024C18 8.04689 18.336 7.71143 18.75 7.71143H20.25C20.664 7.71143 21 8.04689 21 8.46024C21 8.87358 20.664 9.20905 20.25 9.20905Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M20.25 12.2042H18.75C18.336 12.2042 18 11.8687 18 11.4554C18 11.042 18.336 10.7065 18.75 10.7065H20.25C20.664 10.7065 21 11.042 21 11.4554C21 11.8687 20.664 12.2042 20.25 12.2042Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M20.25 15.1998H18.75C18.336 15.1998 18 14.8643 18 14.451C18 14.0376 18.336 13.7021 18.75 13.7021H20.25C20.664 13.7021 21 14.0376 21 14.451C21 14.8643 20.664 15.1998 20.25 15.1998Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M20.25 18.1954H18.75C18.336 18.1954 18 17.8599 18 17.4466C18 17.0332 18.336 16.6978 18.75 16.6978H20.25C20.664 16.6978 21 17.0332 21 17.4466C21 17.8599 20.664 18.1954 20.25 18.1954Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M13.2285 1.89345C13.0575 1.75118 12.828 1.68977 12.612 1.7347L0.612 3.98114C0.2565 4.04703 0 4.35554 0 4.71647V21.1903C0 21.5497 0.2565 21.8598 0.612 21.9257L12.612 24.1721C12.657 24.1811 12.7035 24.1856 12.75 24.1856C12.924 24.1856 13.0935 24.1257 13.2285 24.0133C13.401 23.8711 13.5 23.6584 13.5 23.4368V2.47004C13.5 2.24689 13.401 2.03572 13.2285 1.89345Z"
                    fill="#24AE5F"
                  />
                  <path
                    d="M10.3138 15.4561L7.9423 12.7499L10.3408 9.67078C10.5958 9.3443 10.5358 8.87404 10.2103 8.61945C9.88479 8.36485 9.41379 8.42476 9.15729 8.74974L6.93579 11.6012L5.06379 9.4656C4.78929 9.1511 4.31529 9.12265 4.00629 9.39522C3.69429 9.66778 3.66279 10.141 3.93579 10.451L5.99829 12.8053L3.90729 15.489C3.65229 15.8155 3.71229 16.2858 4.03779 16.5404C4.17579 16.6467 4.33929 16.6976 4.49979 16.6976C4.72329 16.6976 4.94379 16.5988 5.09229 16.4086L7.0048 13.9525L9.18579 16.44C9.33429 16.6108 9.54129 16.6976 9.74979 16.6976C9.92529 16.6976 10.1008 16.6362 10.2433 16.5119C10.5553 16.2394 10.5868 15.7661 10.3138 15.4561Z"
                    fill="#F5F5F5"
                  />
                </g>
                <defs>
                  <clipPath id="clip0">
                    <rect
                      width="24"
                      height="23.962"
                      fill="white"
                      transform="translate(0 0.97168)"
                    />
                  </clipPath>
                </defs>
              </svg>
            </span>
            <span class="template-details-card-wrapper">
              <section :title="`Question_template.txt`" class="question-xls">
                {{ getTruncatedText(new_file.name, 10) }}
              </section>
              <section class="meta-sub-title-question-xls">
                {{ new_file.size / 1000 }}kb
              </section>
            </span>
            <span @click="delete_img" class="template-delete-icon">
              <span class="icon-trash avatar"></span>
            </span>
          </div>
        </section>

        <div class="mgt-14">
          <div class="title-main-wrapper">Assign to a Topic</div>
          <section class="sub-title-main-wrapper">
            Select the topic you wish to assign the uploaded questions to.
          </section>
          <CustomSelect
            :isAjax="true"
            :ajaxFunction="ajaxFunction"
            :items="items"
            @change="handle_topic"
            defaultText="Select Topic"
            :empty_state="empty_state"
            @newAction="addNewTopic"
          />
        </div>

        <!--  -->
      </div>
      <footer class="footer-main-card">
        <span class="left-wrapper-bin-container"> </span>

        <span class="right-wrapper-bin-container">
          <span class="btn-wrapper-right">
            <button
              :disabled="
                new_file && !GET_IS_EXTRACTING && topic_id ? false : true
              "
              @click="extract_questions"
              class="btn btn-accent"
            >
              <span
                class="icon-dotted-roller icon spinner animate font-15"
                v-show="GET_IS_EXTRACTING"
              ></span>
              <span>
                {{
                  !GET_IS_EXTRACTING
                    ? `Extract&nbsp;Questions`
                    : `Extracting&nbsp;Questions`
                }}
              </span>
            </button>
          </span>
        </span>
      </footer>
    </div>
  </div>
</template>

<script>
import UploadFile from "@/components/AttachFileUpload.vue";
import CustomSelect from "@/components/SelectDropdown.vue";

import { getTruncatedText } from "../services/stringMgt";
import {
  POST_EXTRACT_EXCEL_FORMAT_QUESTIONS,
  POST_EXTRACT_TEXT_AIKEN_FORMAT_QUESTIONS,
  GET_IS_EXTRACTING,
  GET_EXTRACTED_QUESTIONS,
  CREATE_TOPIC,
  GET_TOPIC_STATUS,
} from "../pages/QuestionCreate/store.module.QuestionCreateModule/constants";

import { GET_ASSESMENT_DETAILS } from "../pages/AssesmentQuestions/store.module.AssesmentQuestions/constants";

import { mapActions, mapGetters } from "vuex";
import { TOAST_ACTION } from "./SideNotificationSnack/store.module/constants";

export default {
  name: "UploadQuestionsCard",
  components: {
    UploadFile,
    CustomSelect,
  },
  data() {
    return {
      new_file: "",
      topic_id: "",
      topic_title: "",

      empty_state: {
        message: "Topic not found",
        action_name: "Create topic",
        loading: "",
      },
    };
  },
  props: {
    items: {
      type: Array,
      default: () => [],
    },
    ajaxFunction: { type: Function },
  },
  methods: {
    getTruncatedText,
    ...mapActions([
      POST_EXTRACT_EXCEL_FORMAT_QUESTIONS,
      POST_EXTRACT_TEXT_AIKEN_FORMAT_QUESTIONS,
      TOAST_ACTION,
      CREATE_TOPIC,
    ]),

    sendToast(message, state) {
      this[TOAST_ACTION]({
        toastData: {
          toastOpen: true,
          toastText: message,
          toastState: state,
          showBtn: true,
        },
        timeout: 3500,
      });
    },

    handle_topic(payload) {
      this.topic_id = parseInt(payload, 10);
    },
    delete_img() {
      this.new_file = "";
      this.$refs["upload-child"].$refs["upload-main"].value = "";
      this.$emit("disable");
    },
    handleFileUpload($event) {
      const file = $event?.target?.files[0];
      if (!file) return;
      if (
        file.type.includes(
          "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
        ) ||
        file?.type?.includes("text/plain")
      ) {
        if (file.size < 2000000) {
          const reader = new FileReader();
          reader.onload = () => {
            this.new_file = file;
          };
          reader.readAsDataURL(file);
        } else {
          this[TOAST_ACTION]({
            toastData: {
              toastOpen: true,
              toastText: "File Should Not Exceed 2mb",
              toastState: "error",
              showBtn: true,
            },
            timeout: 3000,
          });
        }
      } else {
        this[TOAST_ACTION]({
          toastData: {
            toastOpen: true,
            toastText: "The file-type doesn't belong to text/csv",
            toastState: "error",
            showBtn: true,
          },
          timeout: 3000,
        });
      }
    },
    extract_questions() {
      if (!this.new_file) {
        return;
      }
      const formData = new FormData();
      formData.append("file", this.new_file);

      const file_type = this.new_file?.name?.split(".").pop();

      const endpoint =
        file_type === "txt"
          ? POST_EXTRACT_TEXT_AIKEN_FORMAT_QUESTIONS
          : POST_EXTRACT_EXCEL_FORMAT_QUESTIONS;
      this[endpoint](formData);
    },

    updateTopicTitle(title) {
      this.topic_title = title;
    },

    updateEmptyState(message, action_name, loading) {
      this.empty_state = { message, action_name, loading };
    },

    addNewTopic(title) {
      this.topic_title = title;

      this.updateEmptyState(
        "Please wait while new topic is created...",
        "Create Topic",
        "Creating Topic"
      );

      this.CREATE_TOPIC(this.getNewTopicPayload)
        .then((response) => {
          this.updateEmptyState("Topic not found", "Create Topic", "");

          if (response.code === 200) {
            setTimeout(() => {
              this.sendToast(
                `${this.topic_title} created and added to topic list`,
                "success"
              );
            }, 500);
          } else {
            setTimeout(() => {
              this.sendToast(`Topic creation failed`, "error");
            }, 500);
          }
        })
        .catch((err) => {
          console.log("error trying to create new topic", err);
          setTimeout(() => {
            this.updateEmptyState("Topic not found", "Create Topic", "");
            this.sendToast(`Topic creation failed`, "error");
          }, 500);
        });
    },
  },
  computed: {
    ...mapGetters([
      GET_IS_EXTRACTING,
      GET_EXTRACTED_QUESTIONS,
      GET_ASSESMENT_DETAILS,
      GET_TOPIC_STATUS,
    ]),

    getNewTopicPayload() {
      return {
        topic: this.topic_title,
        subject_id: this.GET_ASSESMENT_DETAILS.data.subject.id,
        class_id: this.GET_ASSESMENT_DETAILS.data.class_id,
        term: this.getAuthUser.term,
      };
    },

    getAuthUser() {
      return JSON.parse(localStorage.getItem("authUser"));
    },
  },
  watch: {
    GET_EXTRACTED_QUESTIONS() {
      if (this[GET_IS_EXTRACTING]) return;
      if (
        this[GET_EXTRACTED_QUESTIONS]?.code === 200 &&
        this[GET_EXTRACTED_QUESTIONS]?.data &&
        this[GET_EXTRACTED_QUESTIONS]?.data?.length &&
        this[GET_EXTRACTED_QUESTIONS]?.message === "successful"
      ) {
        this[TOAST_ACTION]({
          toastData: {
            toastOpen: true,
            toastText: "Questions Extracted",
            toastState: "success",
            showBtn: true,
          },
          timeout: 3000,
          callback: () => {
            this.$router.push({
              name: "LMSPreview",
              query: {
                topic_id: this.topic_id,
              },
            });
          },
        });
      } else {
        this[TOAST_ACTION]({
          toastData: {
            toastOpen: true,
            toastText:
              this[GET_EXTRACTED_QUESTIONS]?.message ||
              "There Was An error Extracting",
            toastState: "error",
            showBtn: true,
          },
          timeout: 3000,
        });
      }
    },
  },
  mounted() {
    this.$emit("disable");
  },
};
</script>

<style lang="scss" scoped>
.create-upload-card-wrapper {
  background: #ffffff;
  box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.15);
  border-radius: 5px;
  margin: 1rem auto;
  .excel-icon-wrapper {
    background: #d7f4eb;
    border-radius: 10px;
    padding: 0.74rem;
  }
  .document-template {
    padding: 1rem;
    .title-main-wrapper {
      font-style: normal;
      font-weight: bold;
      font-size: 14px;
      line-height: 19px;
      display: flex;
      align-items: center;
      color: #000000;
    }
    .sub-title-main-wrapper {
      font-style: normal;
      font-weight: normal;
      font-size: 14px;
      line-height: 165%;
      display: flex;
      align-items: center;
      color: #555555;
    }
  }
  .icon-download {
    padding: 1rem;
    border-radius: 100%;
    background: #f5f5f5;
  }
  .icon-trash {
    padding: 1rem;
    border-radius: 100%;
    background: #f5f5f5;
  }
  .icon-trash:before {
    color: #959595;
    font-size: 14px;
  }
  .icon-download:before {
    color: #959595;
    font-size: 14px;
  }
  .select-wrapper-holder {
    margin-top: 1rem;
    margin-bottom: 1rem;
    width: 61%;
    .select-option-main {
      width: inherit;
      padding: 0.45rem;
      border: 1px solid #d5d5d5;
      box-sizing: border-box;
      border-radius: 5px;
      font-style: normal;
      font-weight: normal;
      font-size: 12px;
      line-height: 16px;
      color: #353535;
    }
  }

  .wrapper-main-template-format-upload {
    @include flex-row-start-wrap;
    .template-details-card-wrapper {
      padding: 0.65rem;
      padding-right: 3rem;
      @include breakpoint-down(lg) {
        padding-right: 1rem;
      }
      .question-xls {
        font-size: 14px;
        line-height: 19px;
        display: flex;
        align-items: center;
        color: #353535;
      }
      .meta-sub-title-question-xls {
        font-style: normal;
        font-weight: normal;
        font-size: 12px;
        line-height: 16px;
        display: flex;
        align-items: center;
        color: #757575;
      }
    }
    .excel-format-template-wrapper {
      @include flex-row-start-nowrap;
      padding: 0.78rem;
      margin-top: 1rem;
      margin-bottom: 1rem;
      margin-right: 1rem;
      background: #ffffff;
      border: 1px solid #d5d5d5;
      box-sizing: border-box;
      border-radius: 5px;
      cursor: pointer;
      .excel-icon-wrapper {
        background: #d7f4eb;
        border-radius: 10px;
        padding: 0.74rem;
      }
    }
    .ms-word-format-template-wrapper {
      @include flex-row-start-nowrap;
      padding: 0.78rem;
      background: #ffffff;
      margin-top: 1rem;
      margin-bottom: 1rem;
      border: 1px solid #d5d5d5;
      box-sizing: border-box;
      border-radius: 5px;
      cursor: pointer;
      .ms-word-icon-wrapper {
        background: #e5e5e5;
        border-radius: 10px;
        padding: 0.74rem;
      }
    }
  }
  .learn-more-label-wrapper {
    margin: 10px 0px;
    .learn-more {
      color: $brand-black;
      font-style: normal;
      font-weight: normal;
      font-size: 0.875rem;
      line-height: 165%;
      align-items: center;
    }
    .accent-bulk-main-label {
      color: $brand-accent;
      font-style: normal;
      font-weight: bold;
      text-decoration: underline;
      font-size: 0.875rem;
      line-height: 165%;
      align-items: center;
    }
  }
  .footer-main-card {
    @include flex-row-between-wrap;
    padding: 1rem;
    background: #f5f5f5;
    border-radius: 0px 0px 5px 5px;

    .icon-wrapper {
      margin: 10px;
    }
    .right-wrapper-bin-container {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      .btn-wrapper-right {
        padding-left: 7px;
        .btn-accent {
          font-weight: bold;
          font-size: 12px;
          line-height: 16px;
          display: flex;
          align-items: center;
          text-transform: uppercase;
          .spinner {
            margin-right: 8px;
            font-size: 15px;
          }
        }
      }
    }
    .left-wrapper-bin-container {
      display: flex;
      justify-content: flex-end;
      align-items: center;
    }
  }
  .mgt-14 {
    margin-top: 14px;
  }
}
</style>
